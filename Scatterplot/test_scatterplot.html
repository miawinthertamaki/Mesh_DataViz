<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>NYCMesh Timeline</title>
		<script type="text/javascript" src="./d3.js"></script>
		<style type="text/css">
			body {
				background-color: black;
			}	

			.yAxis {
				color: grey;
			}

			.xAxis {
				color: grey;
			}
		</style>
	</head>
	<body>
		<script type="text/javascript">
            d3.json('../Updated Data/nodes_cleanedsorted.json')
			.then(function(dataset){

			//Width and height of svg
			var w = 1500;
			var h = 750;
      		var r = 5;
			var padding = 40;
			
			
			//Create scale functions
			xScale = d3.scaleLinear()
						.domain([
							d3.min(dataset, function(d) { return d.requestDate; }),  
							d3.max(dataset, function(d) { return d.requestDate; })
						])
						.range([padding, w - padding]);

			yScale = d3.scaleLinear()
						.domain([
							d3.min(dataset, function(d) { return d.Elevation; }), 
							d3.max(dataset, function(d) { return d.Elevation; })
						])
						.range([h - padding, padding]);
		
			//Define X axis
			xAxis = d3.axisBottom()
						.scale(xScale)
						.ticks(9)

			//Define Y axis
			yAxis = d3.axisLeft()
						.scale(yScale)
						.ticks(10);

			//Create SVG element
			var svg = d3.select("body")
						.append("svg")
						.attr("width", w)
						.attr("height", h);

			
			//Generate guide lines
			svg.selectAll("line")
				.data(dataset)
				.enter()
				.append("line")
				.attr("x1", function(d) {
						return xScale(d.requestDate);
				})
				.attr("x2", function(d) {
						return xScale(d.requestDate);
				})
				.attr("y1", function(d) {
						return h - padding;
				})
				.attr("y2", function(d) {
						return yScale(d.Elevation) + (r*2);
				})
				.attr("stroke", "grey")
				.attr("stroke-width", .25);
			
			
					
			// Generate circles
			svg.selectAll("circle")
				.data(dataset)
				.enter()
				.append("circle")
				.attr("cx", function(d) {
						return xScale(d.requestDate);
				})
				.attr("cy", function(d) {
						return yScale(d.Elevation);
				})
				.attr("r", function(d) {
						return r;
				})
				.attr("fill", 'white')
				.style("fill-opacity", 0.25)
				.on("mouseover",function(d){
					var xPosition = xScale(d.requestDate);
					var yPosition = yScale(d.Elevation);
                    	
					// Adjust color when selecting
					d3.select(this).attr("fill","#f15f53")
					.attr("r", function(d) {
						return r*2;
					})
					.style("fill-opacity", 0.75)
					.append("circle")
					.attr("cx", function(d) {
						return xPosition;
			   		})
			   		.attr("cy", function(d) {
						return yPosition;
			   		});
					
                    //TODO: show tooltip here
					svg.append("text")
				   		.attr("id", "tooltip")
				   		.attr("x", xPosition + r*4)
				   		.attr("y", yPosition)
				   		.attr("text-anchor", "left")
						.attr("font-size", "18px")
						.attr("font-family", "sans-serif")
						.attr("font-weight", "light")
				   		.attr("fill", "#f15f53")
						.text(d.Elevation +"'");
                })
                .on("mouseout",function(d){
                       d3.select(this).attr("fill","white")
					   	.attr("r", function(d){
							return r;
						})
						.style("fill-opacity", 0.25)
					   
					   d3.select("#tooltip")
					  		.remove();
				});
				/*
				//Create X axis
				svg.append("g")
					.attr("class", "xAxis")
					.attr("transform", "translate(0," + (h - padding) + ")")
					.call(xAxis);
				
				//Create Y axis
				svg.append("g")
					.attr("class", "yAxis")
					.attr("transform", "translate(" + (padding) + ",0)")
					.call(yAxis);
				*/
				})
		</script>
	</body>
</html>